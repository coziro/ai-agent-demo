# Design Decisions (設計の決定事項)

このファイルには、プロジェクトの重要な設計判断を記録します。なぜその選択をしたのか、何を比較検討したのかを残すことで、後から見返したときに理解しやすくなります。

---

## ファイル管理方針

**現在の状態:** アクティブな決定事項を記録中（~200行、2025-10-24時点）

**サイズ管理ガイドライン:**
- **300行を超えたら**: 古い決定事項をレビューし、現在も重要なものだけ残す
- **500行を超えたら**: アーカイブ化を検討（`.claude/archive/decisions-YYYY.md`に移動）
- **原則**: よく参照される決定事項のみを本ファイルに保持

**アーカイブの基準（将来の参考）:**
- 過去のプロジェクトフェーズの決定（もう変更される可能性が低い）
- 歴史的価値はあるが日常的には参照しない情報
- 完全に置き換えられた古い決定事項

**YAGNI原則の適用:**
現時点ではアーカイブ構造は作成していません。必要になってから対応します。

---

## テンプレート

新しい決定事項を追加する際は、以下のテンプレートをコピーして使用してください：

```markdown
### [決定事項のタイトル] - YYYY-MM-DD

**状況・課題:**
- どんな問題や選択肢があったか

**検討した選択肢:**
1. 選択肢A: ...
2. 選択肢B: ...
3. 選択肢C: ...

**決定内容:**
- 最終的に選んだ方法

**理由:**
- なぜこれを選んだのか
- どんなトレードオフがあったか

**影響範囲:**
- どのファイル・機能に影響するか

**参考資料:**
- 関連するドキュメント・URL
```

---

## 決定事項の記録

### Chainlitフレームワークの採用 - 2025-10-23

**状況・課題:**
- 対話型AIアプリケーションを構築する必要があった

**検討した選択肢:**
1. Streamlit: データ分析・可視化向け
2. Gradio: シンプルなUI、主にML demo用
3. Chainlit: チャットUI特化、LLM統合が強力

**決定内容:**
- Chainlitを採用

**理由:**
- チャットインターフェースに最適化されている
- LangChain/LlamaIndexとの統合が容易
- ストリーミング対応が標準
- 日本語対応が良好

**影響範囲:**
- [app.py](../app.py)
- [.chainlit/config.toml](../.chainlit/config.toml)
- 依存関係: pyproject.toml

**参考資料:**
- https://docs.chainlit.io/

---

### Chainlit翻訳ファイルの管理方針 - 2025-10-23（2025-10-24更新）

**状況・課題:**
- Chainlitには多言語対応の翻訳ファイルが自動生成される
- 当初は不要な言語ファイルを削除する方針だったが、Chainlit起動時に自動再生成されることが判明

**検討した選択肢:**
1. 翻訳ファイルを削除し続ける → Chainlitが毎回自動生成するため不可能
2. .gitignoreで除外する → git statusが煩雑になる
3. **自動生成されたファイルをそのままコミットする** ✓

**決定内容:**
- **すべての翻訳ファイルをgitで管理する**（自動生成されるファイルを含む）
- **日本語(ja.json)と英語(en-US.json)のみを積極的にメンテナンス**
- その他の言語ファイルは自動生成されたものをそのままコミット

**理由:**
- Chainlitが起動時に翻訳ファイルを自動生成する仕様
- .gitignoreで除外すると、git statusにuntrackedファイルが常に表示される
- 自動生成ファイルをコミットすることで、git statusをクリーンに保つ
- 日英以外の言語は編集しないが、存在してもコストは低い
- チームメンバーが同じ環境を再現しやすい

**メンテナンス方針:**
- ja.jsonとen-US.jsonのみ手動編集対象
- その他の言語ファイルは触らない（Chainlitの自動生成に任せる）

**日本語翻訳ファイルの可読性向上:**
- ja.jsonのUnicodeエスケープシーケンス（`\u30ad\u30e3\u30f3\u30bb\u30eb`）を実際の日本語文字（`キャンセル`）に変換
- 理由: 開発者が直接編集しやすくするため、可読性を優先
- 実施日: 2025-10-23（コミット `156ad7e`）
- 注意: JSONとしては両方とも有効だが、人間が読み書きしやすい形式を採用

**影響範囲:**
- [.chainlit/translations/](../.chainlit/translations/)
- 特に [ja.json](../.chainlit/translations/ja.json) は編集対象

**変更履歴:**
- 2025-10-23: 当初は削除方針を採用（コミット `a8b04b1`）
- 2025-10-23: ja.jsonを人間が読みやすい形式に変換（コミット `156ad7e`）
- 2025-10-24: Chainlitの自動生成仕様が判明し、方針変更してコミット（コミット `f3f06db`）

---

### DevContainer + uv ベースの開発環境を採用 - 2025-10-23

**状況・課題:**
- チーム開発で環境の一貫性を保つ必要があった
- ローカル環境の差異による「私の環境では動く」問題を避けたい
- Python依存関係管理ツールの選定

**検討した選択肢:**

**開発環境:**
1. ローカル環境に直接インストール: 環境差異が発生しやすい
2. Docker Compose: 設定が複雑
3. **DevContainer**: VS Code統合、開発者体験が良い ✓

**Python依存関係管理:**
1. pip + requirements.txt: 標準だが機能が限定的
2. Poetry: 人気だが遅い
3. **uv**: 高速（Rust製）、モダン ✓

**Pythonバージョン:**
- Python 3.12: 最新の安定版、型ヒント機能の向上

**決定内容:**
- **DevContainer** (VS Code Dev Containers)を開発環境として採用
- **Docker** ベースイメージ: `ghcr.io/astral-sh/uv:python3.12-bookworm-slim`
- **uv** をPython依存関係管理ツールとして採用
- **Python 3.12** を使用

**理由:**
- **DevContainer**:
  - VS Codeとシームレスに統合
  - 全開発者が同一環境で作業可能
  - 環境構築が簡単（`devcontainer.json`1つで完結）
- **uv**:
  - 非常に高速（Rust製）
  - pyproject.toml標準対応
  - lockfileによる再現性の確保
  - DevContainerとの相性が良い
- **公式uvイメージ使用**:
  - uvとPythonが事前インストール済み
  - メンテナンスされている公式イメージ
- **シンプル設定の方針**:
  - 最小限の設定で開始（git、curl、vimのみ追加）
  - 複雑な設定は必要性が発生してから追加
  - 過剰な事前最適化を避ける（YAGNI原則）

**影響範囲:**
- [.devcontainer/devcontainer.json](../.devcontainer/devcontainer.json)
- [.devcontainer/Dockerfile](../.devcontainer/Dockerfile)
- [pyproject.toml](../pyproject.toml)
- uv.lock
- VS Code拡張機能の自動インストール（Python、Jupyter、Claude Code）

**参考資料:**
- https://code.visualstudio.com/docs/devcontainers/containers
- https://github.com/astral-sh/uv
- https://github.com/astral-sh/uv/pkgs/container/uv

---

### .claude/ディレクトリのGit管理方針 - 2025-10-24

**状況・課題:**
- Claude Codeのコンテキスト管理ファイル（.claude/）をGitで管理すべきか検討
- 個人的なメモと、プロジェクトの知識ベースの使い分けが必要

**検討した選択肢:**
1. すべて.gitignore（個人メモとして使う） → 知識共有できない
2. 選択的にコミット（設計決定のみ） → 管理が複雑
3. **すべてコミット + 個人メモ用ファイルを別途用意** ✓

**決定内容:**
- **.claude/配下のファイルはすべてGitにコミットする**
- **個人的なメモは`.claude/personal.md`に記録し、.gitignoreで除外**

**理由:**
- このプロジェクトは**OSSとして公開**する
- **設計決定（decisions.md）は他の開発者にとって非常に価値がある**
  - 「なぜこの技術を選んだのか」はコードだけでは分からない
  - 過去の検討内容を知ることで、コントリビューターが参加しやすくなる
- **プロジェクトの透明性**が向上する
- 個人的なメモは`personal.md`に分離することで、公開・非公開を明確に区別

**運用ルール:**
- **コミットするファイル（公開）:**
  - decisions.md - 設計決定とその理由
  - references.md - 参考資料・リンク集
  - todo.md - プロジェクトタスク（個人的なものは除く）
  - context.md - 現在の作業状況（プロジェクトに関連するもののみ）

- **コミットしないファイル（個人用）:**
  - personal.md - 完全に個人的なメモ、一時的なメモ

**影響範囲:**
- [.claude/](../.claude/) - すべてのファイル（personal.md除く）
- [.gitignore](../.gitignore) - personal.mdを追加

**参考:**
成功しているOSSプロジェクトの多くは、設計決定やADR（Architecture Decision Records）を公開しており、これがコミュニティの成長に貢献している。

---

## 次に決めるべきこと

このセクションには、**まだ決定していない重要な設計判断**を記録します。
決定したら上の「決定事項の記録」セクションに移動してください。

### 近いうちに決めるべきこと

- [ ] **LLMプロバイダーの選定** - ChainlitアプリにLLMを統合する際に必要
  - 選択肢: OpenAI / Anthropic / Azure OpenAI / ローカルモデル（Ollama等）
  - 検討ポイント: コスト、日本語性能、レイテンシ、プライバシー
  - 影響: app.py、環境変数、依存関係

### 将来的に決めるべきこと

- [ ] **認証・認可方式** - 本番環境でユーザー管理が必要になった場合
  - 選択肢: OAuth、JWT、Chainlit組み込み認証

- [ ] **データ永続化方式** - チャット履歴や会話データを保存する場合
  - 選択肢: PostgreSQL、SQLite、クラウドDB

- [ ] **ベクトルDBの選定** - RAG（文書検索）機能が必要になった場合
  - 選択肢: Chroma、Pinecone、Weaviate、Qdrant

- [ ] **デプロイ方法** - 本番環境への公開方法
  - 選択肢: Docker Compose、Cloud Run、Heroku、Railway
